---
title: "Homework 2.2"
author: "Ettore Puccetti Lorenzo Foa`"
date: "11/20/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE, message=FALSE}
library("vcd")
library("vcdExtra")
```

```{r dataset loading}
Elks.table=data.frame(expand.grid(Action=c("Crossing", "Retreat"), Traffic=c("Low", "High"),
                                  Vehicle=c("Car", "Truck")), count=c(287,57,237,52,40,42,57,12))

# We want to have the table ordered, with Crossing, Car and Low traffic first
Elks.table$Action = ordered(Elks.table$Action, levels = c("Crossing","Retreat"))
Elks.table$Vehicle = ordered(Elks.table$Vehicle, levels = c("Car","Truck"))
Elks.table$Traffic = ordered(Elks.table$Traffic, levels = c("Low","High"))

Elks.partial = xtabs(count~Action+Vehicle+Traffic, Elks.table)

```

### LOW TRAFFIC

```{r low traffic}

Elks.low.Traffic = Elks.partial[,,1]
chisq.test(Elks.low.Traffic)
```
il p-value e' piccolo, quindi rifiutiamo l'ipotesi dell'indipendenza

```{r mosaic plot}
mosaic(t(Elks.low.Traffic), gp=shading_max, split_vertical=TRUE, labeling = labeling_values, main = "low traffic")
```



confermato dal mosaic plot: i Retreat con i Truck sono molti di piu` di quello che ci si aspetta, anche i Crossing con Car abbondano, seppur in misura minone scarseggiano i Retrat con Car e i Crossing con Truck


```{r}
or.low = oddsratio(Elks.low.Traffic, log=FALSE)
or.low
```

or.low ~= 5.28 vuol dire che le possibilita  di attraversare quando passa una macchina sono 5 volte di piu`  rispetto a quando passa un camion


```{r}
confint(or.low)
```


### HIGH TRAFFIC

```{r}
Elks.high.Traffic = Elks.partial[,,2]
chisq.test(Elks.high.Traffic)
```

p-value = 1, non possiamo rifiutare l'ipotesi di indipendenza

```{r}
mosaic(t(Elks.high.Traffic), gp=shading_max, split_vertical=TRUE, labeling = labeling_values, main = "high traffic")
```

mosaic sembrerebbe confermare l'indipendenza

```{r}

or.high = oddsratio(Elks.high.Traffic, log=FALSE)
or.high
```

or.high ~= 0.96 vuol dire che le possibilita  di attraversare quando passa una macchina 
sono quasi quelle di quando passa un camion

```{r}
confint(or.high)
```


## comparison between HIGH and LOW traffic

```{r}
fourfold(Elks.partial)
```

si vede che in uno sono indipendenti e nell'altro no (grazie al cazzo) ma c'e` da spiegare come si interpretano i due grafici

```{r}
or.part = oddsratio(Elks.partial, log=FALSE)
plot(or.part)
```

since the distributuon of oddratio for trafic=high is too skewed, we try to plot it again in log scale

```{r}
or.part = oddsratio(Elks.partial, log=T)
plot(or.part)
```

QUALE E MEGLIO??
  Non credo si possano lasciare entrambi i grafici, scegliere quale dobbiamo usare e commentare perche` l'abbiamo scelto


## MARGINAL

  mancano tutti i commenti sui grafici

```{r}
Elks.marginal = xtabs(count~Action+Vehicle, Elks.table)
chisq.test(Elks.marginal)
```
p-value piccolo, rifiutiamo ipotesi indipendenza


```{r}
mosaic(t(Elks.marginal), gp=shading_max, split_vertical=TRUE, labeling = labeling_values, main = "marginal")
```

```{r}
fourfold(Elks.marginal)
```

  conclusione?




## HOMOGENUES ASSOCIATION

```{r}
woolf_test(Elks.partial)
```

p-value piccolo (~0.0001) ci dice che possiamo rifiutare l'ipotesi di omogeneita  di odds ratio tra le varie
tabelle parziali, e quindi non possiamo prenderne una sola e generalizzare ma vanno discusse una per una.


## CONDITIONAL INDEPENDENCE 

```{r}
mantelhaen.test(Elks.partial)
```
altro p-value piccolo, le odd ratio non sono statisticamente tutte 1
